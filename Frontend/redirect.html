<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checking Payment Status...</title>
</head>
<body>
    <h1>Redirecting in <span id="countdown">5</span> seconds...</h1>

    <script>
        // Function to extract query parameters from URL
        function getQueryParam(name) {
            const params = new URLSearchParams(window.location.search);
            return params.get(name);
        }

        // Extract link_id from the URL
        const linkId = getQueryParam("link_id");
        if (!linkId) {
            document.body.innerHTML = "<h2>Error: Missing Payment Link ID</h2>";
            throw new Error("Missing Payment Link ID in URL");
        }

        let timeLeft = 5; // Countdown starts from 5 seconds
        const countdownElement = document.getElementById("countdown");

        const countdownTimer = setInterval(() => {
            timeLeft--;
            countdownElement.textContent = timeLeft;
            
            if (timeLeft <= 0) {
                clearInterval(countdownTimer);

                // Call backend to check payment status
                fetch(`${CONFIG.API_URL}/check-payment-status?link_id=${linkId}`)
                    .then(response => response.json())
                    .then(data => {
                        console.log("Payment Status Response:", data);

                        if (data.error) {
                            document.body.innerHTML = `<h2>Error: ${data.error}</h2>`;
                            return;
                        }

                        if (data.link_status === "PAID") {
                            // Redirect to success page
                            window.location.href = `${CONFIG.API_URL}/success.html`;
                        } else {
                            // Redirect to failure page
                            window.location.href = `${CONFIG.API_URL}/failure.html`;
                        }
                    })
                    .catch(error => {
                        console.error("Error fetching payment status:", error);
                        document.body.innerHTML = "<h2>Error checking payment status. Please try again.</h2>";
                    });
            }
        }, 1000);
    </script>

<script src="config.js"></script>


</body>
</html>
